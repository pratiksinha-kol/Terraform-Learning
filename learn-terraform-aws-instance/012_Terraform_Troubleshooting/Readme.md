## Troubleshoot Terraform

https://developer.hashicorp.com/terraform/tutorials/configuration-language/troubleshooting-workflow 

https://www.pluralsight.com/resources/blog/cloud/how-to-troubleshoot-5-common-terraform-errors 

![Assets](/learn-terraform-aws-instance/Images/assets.PNG)

There are four potential types of issues that you could experience with Terraform: language, state, core, and provider errors. Starting from the type of error closest to the user:

1. **Language errors**: The primary interface for Terraform is the HashiCorp Configuration Language (HCL), a declarative configuration language. The Terraform core application interprets the configuration language. When Terraform encounters a syntax error in your configuration, it prints out the line numbers and an explanation of the error.

2. **State errors**: The Terraform state file stores information on provisioned resources. It maps resources to your configuration and tracks all associated metadata. If state is out of sync, Terraform may destroy or change your existing resources. After you rule out configuration errors, review your state. Ensure your configuration is in sync by refreshing, importing, or replacing resources.

3. **Core errors**: The Terraform core application contains all the logic for operations. It interprets your configuration, manages your state file, constructs the resource dependency graph, and communicates with provider plugins. Errors produced at this level may be a bug. Later in this tutorial, you will learn best practices for opening a GitHub issue for the core development team.

4. **Provider errors**: The provider plugins handle authentication, API calls, and mapping resources to services. Later in this tutorial, you will learn best practices for opening a GitHub issue for the provider development team.

### Enable Terraform logging

Terraform 0.15 allows you to generate logs from the Terraform provider and the core application separately. The Terraform development team needs the core logs for your attempted operation to troubleshoot core-related errors. To enable core logging, set the `TF_LOG_CORE` environment variable to the appropriate [log level](https://developer.hashicorp.com/terraform/internals/debugging). For bug reports, you should use the TRACE level.

```
export TF_LOG_CORE=TRACE
```
`TRACE` provides the highest level of logging and contains all the information the development teams need. There are other logging levels, but are typically reserved for developers looking for specific information.

## 
You can also generate provider logs by setting the `TF_LOG_PROVIDER` environment variable. By including these in your bug reports, the provider development team can reproduce and debug provider specific errors.

```
export TF_LOG_PROVIDER=TRACE
```

You can set `TF_LOG` to one of the log levels (in order of decreasing verbosity) `TRACE`, `DEBUG`, `INFO`, `WARN` or `ERROR` to change the verbosity of the logs.

Setting `TF_LOG` to `JSON` outputs logs at the `TRACE` level or higher, and uses a parseable JSON encoding as the formatting.

## 

The `TF_LOG_PATH` variable will create the specified file and append logs generated by Terraform.

```
export TF_LOG_PATH=logs.txt
```

### FOLLOW ALONG

```
TF_LOG_PROVIDER=TRACE terraform apply
```

```
TF_LOG=TRACE terraform apply
```

This will create a log file with the given name. 
```
TF_LOG=TRACE TF_LOG_PATH=./terraform_logs.txt terraform apply 
```